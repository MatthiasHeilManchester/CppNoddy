\doxysubsection{Tests/\+E\+V\+P/\+E\+V\+P\+Orr\+Sommerfeld\+Sparse\+\_\+slepcz.cpp File Reference}
\label{EVPOrrSommerfeldSparse__slepcz_8cpp}\index{Tests/EVP/EVPOrrSommerfeldSparse\_slepcz.cpp@{Tests/EVP/EVPOrrSommerfeldSparse\_slepcz.cpp}}
{\ttfamily \#include $<$Generic\+\_\+bundle.\+h$>$}\newline
{\ttfamily \#include $<$Sparse\+Linear\+Eigen\+System.\+h$>$}\newline
{\ttfamily \#include $<$Slepc\+Session.\+h$>$}\newline
\doxysubsubsection*{Functions}
\begin{DoxyCompactItemize}
\item 
int \textbf{ main} (int argc, char $\ast$argv[$\,$])
\end{DoxyCompactItemize}


\doxysubsubsection{Detailed Description}
Solves the following linear eigenvalue problem for values $ c $ that satisfy \+: \[ \phi\textnormal{\textquotesingle}\textnormal{\textquotesingle}(y) - \alpha^2 \phi(y) - \psi(y) = 0\,, \] \[ \psi\textnormal{\textquotesingle}\textnormal{\textquotesingle}(y) - \alpha^2 \psi(y) - i \alpha Re \left \{ ( U(y) - c ) \psi(y) - U\textnormal{\textquotesingle}\textnormal{\textquotesingle}(y) \phi \right \} = 0\,, \] subject to $ \phi(\pm 1) = \phi\textnormal{\textquotesingle}(\pm 1) = 0 $ where $ \alpha = 1.02 $, $ Re = 5772.2 $ and $ U(y) = 1 - y^2 $. The matrix problem is constructed manually in this case, using second-\/order finite differences. A sparse eigenvalue routine is employed, via S\+L\+E\+Pc. These values approximately correspond to the first neutral temporal mode in plane Poiseuille flow, therefore the test to be satisfied is that an eigenvalue exists with $ \Im ( c ) \approx 0 $. 

\doxysubsubsection{Function Documentation}
\mbox{\label{EVPOrrSommerfeldSparse__slepcz_8cpp_a0ddf1224851353fc92bfbff6f499fa97}} 
\index{EVPOrrSommerfeldSparse\_slepcz.cpp@{EVPOrrSommerfeldSparse\_slepcz.cpp}!main@{main}}
\index{main@{main}!EVPOrrSommerfeldSparse\_slepcz.cpp@{EVPOrrSommerfeldSparse\_slepcz.cpp}}
\doxyparagraph{main()}
{\footnotesize\ttfamily int main (\begin{DoxyParamCaption}\item[{int}]{argc,  }\item[{char $\ast$}]{argv[$\,$] }\end{DoxyParamCaption})}



Definition at line 24 of file E\+V\+P\+Orr\+Sommerfeld\+Sparse\+\_\+slepcz.\+cpp.


\begin{DoxyCode}{0}
\DoxyCodeLine{25 \{}
\DoxyCodeLine{26   SlepcSession::getInstance(argc,argv);}
\DoxyCodeLine{27 }
\DoxyCodeLine{28   cout << \textcolor{stringliteral}{"\(\backslash\)n"};}
\DoxyCodeLine{29   cout << \textcolor{stringliteral}{"=== EVP: Temporal spectra of the Orr-\/Sommerfeld eqn =\(\backslash\)n"};}
\DoxyCodeLine{30   cout << \textcolor{stringliteral}{"===  with a matrix problem assembled by hand and \(\backslash\)n"};}
\DoxyCodeLine{31   cout << \textcolor{stringliteral}{"===  eigenproblem solved with SLEPc sparse solver.\(\backslash\)n"};}
\DoxyCodeLine{32   cout << \textcolor{stringliteral}{"\(\backslash\)n"};}
\DoxyCodeLine{33 }
\DoxyCodeLine{34   \textcolor{comment}{// discretise with these many nodal points}}
\DoxyCodeLine{35   \textcolor{keyword}{const} std::size\_t nodes( 1001 );}
\DoxyCodeLine{36   \textcolor{comment}{// we'll solve as TWO second order problems}}
\DoxyCodeLine{37   \textcolor{keyword}{const} std::size\_t N( 2 * nodes );}
\DoxyCodeLine{38   \textcolor{comment}{// domain boundaries}}
\DoxyCodeLine{39   \textcolor{keyword}{const} \textcolor{keywordtype}{double} left = -\/1.0;}
\DoxyCodeLine{40   \textcolor{keyword}{const} \textcolor{keywordtype}{double} right = 1.0;}
\DoxyCodeLine{41   \textcolor{comment}{// spatial step for a uniform mesh}}
\DoxyCodeLine{42   \textcolor{keyword}{const} \textcolor{keywordtype}{double} d = ( right -\/ left ) / ( nodes -\/ 1 );}
\DoxyCodeLine{43 }
\DoxyCodeLine{44   \textcolor{comment}{// matrices for the EVP, initialised with zeroes}}
\DoxyCodeLine{45   SparseMatrix<D\_complex> a( N, N );}
\DoxyCodeLine{46   SparseMatrix<D\_complex> b( N, N );}
\DoxyCodeLine{47 }
\DoxyCodeLine{48   \textcolor{comment}{// streamwise wavenumber and Reynolds number}}
\DoxyCodeLine{49   \textcolor{keyword}{const} \textcolor{keywordtype}{double} alpha ( 1.02 );}
\DoxyCodeLine{50   \textcolor{keyword}{const} \textcolor{keywordtype}{double} Re ( 5772.2 );}
\DoxyCodeLine{51   \textcolor{keyword}{const} D\_complex I( 0.0, 1.0 );}
\DoxyCodeLine{52 }
\DoxyCodeLine{53   \textcolor{comment}{// boundary conditions at the left boundary}}
\DoxyCodeLine{54   a( 0, 0 ) = 1.0;           \textcolor{comment}{// phi( left ) = 0}}
\DoxyCodeLine{55   a( 1, 0 ) = -\/1.5 / d;      \textcolor{comment}{// phi'( left ) = 0}}
\DoxyCodeLine{56   a( 1, 2 ) = 2.0 / d;}
\DoxyCodeLine{57   a( 1, 4 ) = -\/0.5 / d;}
\DoxyCodeLine{58   \textcolor{comment}{// fill the interior nodes}}
\DoxyCodeLine{59   \textcolor{keywordflow}{for} ( std::size\_t i = 1; i <= nodes -\/ 2; ++i )}
\DoxyCodeLine{60   \{}
\DoxyCodeLine{61     \textcolor{comment}{// position in the channel}}
\DoxyCodeLine{62     \textcolor{keyword}{const} \textcolor{keywordtype}{double} y = left + i * d;}
\DoxyCodeLine{63     \textcolor{comment}{// Poiseuille flow profile}}
\DoxyCodeLine{64     \textcolor{keyword}{const} \textcolor{keywordtype}{double} U = ( 1.0 -\/ y * y );}
\DoxyCodeLine{65     \textcolor{keyword}{const} \textcolor{keywordtype}{double} Udd = -\/2.0;}
\DoxyCodeLine{66 }
\DoxyCodeLine{67     \textcolor{comment}{// the first quation at the i'th nodal point}}
\DoxyCodeLine{68     std::size\_t row = 2 * i;}
\DoxyCodeLine{69     a( row, row ) = -\/2.0 / ( d * d ) -\/ alpha * alpha;}
\DoxyCodeLine{70     a( row, row -\/ 2 ) = 1.0 / ( d * d );}
\DoxyCodeLine{71     a( row, row + 2 ) = 1.0 / ( d * d );}
\DoxyCodeLine{72     a( row, row + 1 ) = -\/1.0;}
\DoxyCodeLine{73 }
\DoxyCodeLine{74     row += 1;}
\DoxyCodeLine{75     \textcolor{comment}{// the second equation at the i'th nodal point}}
\DoxyCodeLine{76     a( row, row ) = -\/2.0 / ( d * d ) -\/ alpha * alpha -\/ I * alpha * Re * U;}
\DoxyCodeLine{77     a( row, row -\/ 2 ) = 1.0 / ( d * d );}
\DoxyCodeLine{78     a( row, row + 2 ) = 1.0 / ( d * d );}
\DoxyCodeLine{79     a( row, row -\/ 1 ) = I * alpha * Re * Udd;}
\DoxyCodeLine{80 }
\DoxyCodeLine{81     b( row, row ) = -\/ I * alpha * Re;}
\DoxyCodeLine{82   \}}
\DoxyCodeLine{83   \textcolor{comment}{// boundary conditions at right boundary}}
\DoxyCodeLine{84   a( N -\/ 2, N -\/ 2 ) = 1.5 / d;}
\DoxyCodeLine{85   a( N -\/ 2, N -\/ 4 ) = -\/2.0 / d;}
\DoxyCodeLine{86   a( N -\/ 2, N -\/ 6 ) = 0.5 / d; \textcolor{comment}{// psi'( right ) = 0}}
\DoxyCodeLine{87   a( N -\/ 1, N -\/ 2 ) = 1.0;     \textcolor{comment}{// psi( right ) = 0}}
\DoxyCodeLine{88 }
\DoxyCodeLine{89   \textcolor{comment}{/* Note: current KSP configuration uses an LU preconditioner and MUMPS}}
\DoxyCodeLine{90 \textcolor{comment}{    which doesn't mind zeros on the diagonal of a. */}}
\DoxyCodeLine{91 }
\DoxyCodeLine{92 }
\DoxyCodeLine{93   \textcolor{comment}{// a vector for storing the eigenvalues}}
\DoxyCodeLine{94   DenseVector<D\_complex> lambdas;}
\DoxyCodeLine{95   SparseLinearEigenSystem<D\_complex> system( \&a, \&b );}
\DoxyCodeLine{96   system.set\_target(D\_complex(0.2,0.0));}
\DoxyCodeLine{97   system.set\_nev(4);}
\DoxyCodeLine{98   system.set\_order( \textcolor{stringliteral}{"EPS\_TARGET\_MAGNITUDE"} );}
\DoxyCodeLine{99 }
\DoxyCodeLine{100   \textcolor{keywordflow}{try}}
\DoxyCodeLine{101   \{}
\DoxyCodeLine{102     system.eigensolve();}
\DoxyCodeLine{103   \}}
\DoxyCodeLine{104   \textcolor{keywordflow}{catch} (\textcolor{keyword}{const} std::runtime\_error \&error )}
\DoxyCodeLine{105   \{}
\DoxyCodeLine{106     cout << \textcolor{stringliteral}{" \(\backslash\)033[1;31;48m  * FAILED THROUGH EXCEPTION BEING RAISED \(\backslash\)033[0m\(\backslash\)n"};}
\DoxyCodeLine{107     \textcolor{keywordflow}{return} 1;}
\DoxyCodeLine{108   \}}
\DoxyCodeLine{109   \textcolor{comment}{// tag any eigenvalues with imaginary part > -\/0.1}}
\DoxyCodeLine{110   system.set\_shift( D\_complex( 0.0, -\/0.1 ) );}
\DoxyCodeLine{111   system.tag\_eigenvalues\_upper( + 1 );}
\DoxyCodeLine{112   lambdas = system.get\_tagged\_eigenvalues();}
\DoxyCodeLine{113   lambdas.dump();}
\DoxyCodeLine{114   \textcolor{keywordtype}{double} min\_growth\_rate( lambdas[ 0 ].imag() );}
\DoxyCodeLine{115   \textcolor{comment}{// make sure we have a near neutral mode}}
\DoxyCodeLine{116   \textcolor{keyword}{const} \textcolor{keywordtype}{double} tol = 1.e-\/3;}
\DoxyCodeLine{117 }
\DoxyCodeLine{118   std::string dirname(\textcolor{stringliteral}{"./DATA"});}
\DoxyCodeLine{119   mkdir( dirname.c\_str(), S\_IRWXU );}
\DoxyCodeLine{120 }
\DoxyCodeLine{121   TrackerFile spectrum( \textcolor{stringliteral}{"./DATA/spectrum.dat"} );}
\DoxyCodeLine{122   spectrum.push\_ptr( \&lambdas, \textcolor{stringliteral}{"evs"} );}
\DoxyCodeLine{123   spectrum.update();}
\DoxyCodeLine{124 }
\DoxyCodeLine{125   \textcolor{keywordflow}{if} ( std::abs( min\_growth\_rate ) < tol )}
\DoxyCodeLine{126   \{}
\DoxyCodeLine{127     cout << \textcolor{stringliteral}{"\(\backslash\)033[1;32;48m  * PASSED \(\backslash\)033[0m\(\backslash\)n"};}
\DoxyCodeLine{128     \textcolor{keywordflow}{return} 0;}
\DoxyCodeLine{129   \}}
\DoxyCodeLine{130 }
\DoxyCodeLine{131   cout << \textcolor{stringliteral}{"\(\backslash\)033[1;31;48m  * FAILED \(\backslash\)033[0m\(\backslash\)n"};}
\DoxyCodeLine{132   cout << \textcolor{stringliteral}{"    Final error = "} << min\_growth\_rate << \textcolor{stringliteral}{"\(\backslash\)n"};}
\DoxyCodeLine{133   \textcolor{keywordflow}{return} 1;}
\DoxyCodeLine{134   }
\DoxyCodeLine{135 \}}

\end{DoxyCode}


References Cpp\+Noddy\+::\+Example\+::alpha, Cpp\+Noddy\+::\+Dense\+Vector$<$ \+\_\+\+Type $>$\+::dump(), Cpp\+Noddy\+::\+Utility\+::imag(), Cpp\+Noddy\+::\+Tracker\+File\+::push\+\_\+ptr(), Cpp\+Noddy\+::\+Example\+::\+Re, U, Cpp\+Noddy\+::\+Example\+::\+Udd(), and Cpp\+Noddy\+::\+Tracker\+File\+::update().

