\doxysubsection{Tests/\+E\+V\+P/\+E\+V\+P\+Harmonic\+Sparse\+\_\+slepcd.cpp File Reference}
\label{EVPHarmonicSparse__slepcd_8cpp}\index{Tests/EVP/EVPHarmonicSparse\_slepcd.cpp@{Tests/EVP/EVPHarmonicSparse\_slepcd.cpp}}
{\ttfamily \#include $<$Utility.\+h$>$}\newline
{\ttfamily \#include $<$Timer.\+h$>$}\newline
{\ttfamily \#include $<$Sparse\+Linear\+Eigen\+System.\+h$>$}\newline
{\ttfamily \#include $<$Slepc\+Session.\+h$>$}\newline
{\ttfamily \#include \char`\"{}../\+Utils\+\_\+\+Fill.\+h\char`\"{}}\newline
\doxysubsubsection*{Functions}
\begin{DoxyCompactItemize}
\item 
int \textbf{ main} (int argc, char $\ast$argv[$\,$])
\end{DoxyCompactItemize}


\doxysubsubsection{Detailed Description}
Solves the harmonic equation \[ f\textnormal{\textquotesingle}\textnormal{\textquotesingle}(x) + \lambda f(x) = 0 \] as an eigenvalue problem for $ \lambda $ over the unit domain with homogeneous boundary conditions for $ f(x) $, returning any eigenvalue(s) with absolute value less than 10. The resulting eigenvalues should approach $ m^2 \pi^2 $ as $n \to \infty $ with $ O(\Delta^2)$ corrections where $ \Delta = 1/(n-1) $ and $ n $ is the number of nodal points in the FD representation; a 2nd order central difference representation of \[ f\textnormal{\textquotesingle}\textnormal{\textquotesingle}(x_i) + \lambda f(x_i) = \frac{ f_{i-1} - 2f_i + f_{i+1} }{ \Delta^2 } + \lambda f_i + O(\Delta^2) \] is used. The matrix problem is solved for a subset of eigenvalues within a specified distance of the origin of the comlplex plane by calling the S\+L\+E\+Pc generalised eigenvalue routine. 

\doxysubsubsection{Function Documentation}
\mbox{\label{EVPHarmonicSparse__slepcd_8cpp_a0ddf1224851353fc92bfbff6f499fa97}} 
\index{EVPHarmonicSparse\_slepcd.cpp@{EVPHarmonicSparse\_slepcd.cpp}!main@{main}}
\index{main@{main}!EVPHarmonicSparse\_slepcd.cpp@{EVPHarmonicSparse\_slepcd.cpp}}
\doxyparagraph{main()}
{\footnotesize\ttfamily int main (\begin{DoxyParamCaption}\item[{int}]{argc,  }\item[{char $\ast$}]{argv[$\,$] }\end{DoxyParamCaption})}



Definition at line 27 of file E\+V\+P\+Harmonic\+Sparse\+\_\+slepcd.\+cpp.


\begin{DoxyCode}{0}
\DoxyCodeLine{28 \{}
\DoxyCodeLine{29   SlepcSession::getInstance(argc,argv);}
\DoxyCodeLine{30   }
\DoxyCodeLine{31   cout << \textcolor{stringliteral}{"\(\backslash\)n"};}
\DoxyCodeLine{32   cout << \textcolor{stringliteral}{"=== EVP: Harmonic equation solved using SLEPc  ======\(\backslash\)n"};}
\DoxyCodeLine{33   cout << \textcolor{stringliteral}{"===  with a manually assembled matrix problem.\(\backslash\)n"};}
\DoxyCodeLine{34   cout << \textcolor{stringliteral}{"\(\backslash\)n"};}
\DoxyCodeLine{35   }
\DoxyCodeLine{36   cout.precision( 12 );}
\DoxyCodeLine{37   cout << \textcolor{stringliteral}{" Number of nodal points : Leading eigenvalue error : Total CPU time taken (ms) \(\backslash\)n"};}
\DoxyCodeLine{38   \textcolor{keywordtype}{bool} failed = \textcolor{keyword}{false};}
\DoxyCodeLine{39   \textcolor{keywordtype}{size\_t} N = 4;}
\DoxyCodeLine{40   \textcolor{comment}{// a vector for the eigenvalues}}
\DoxyCodeLine{41   DenseVector<D\_complex> lambdas;}
\DoxyCodeLine{42   Timer timer;}
\DoxyCodeLine{43   \textcolor{keywordflow}{for} ( \textcolor{keywordtype}{int} i = 2; i < 11; ++i )}
\DoxyCodeLine{44   \{}
\DoxyCodeLine{45     N = ( size\_t ) ( std::pow( 2., i ) );}
\DoxyCodeLine{46     \textcolor{keyword}{const} \textcolor{keywordtype}{double} delta = 1. / ( N -\/ 1 );}
\DoxyCodeLine{47     \textcolor{keyword}{const} \textcolor{keywordtype}{double} delta2 = delta * delta;}
\DoxyCodeLine{48     \textcolor{comment}{// matrix problem}}
\DoxyCodeLine{49     \textcolor{keyword}{typedef} \textcolor{keywordtype}{double} PETSC\_type;}
\DoxyCodeLine{50     SparseMatrix<PETSC\_type> a( N, N );}
\DoxyCodeLine{51     \textcolor{comment}{// Finite difference representation of f''(x)}}
\DoxyCodeLine{52     \textcolor{comment}{// here it's a a tri-\/diagonal system}}
\DoxyCodeLine{53     Utils\_Fill::fill\_band(a, -\/1, (PETSC\_type)(1.0 / delta2));}
\DoxyCodeLine{54     Utils\_Fill::fill\_band(a,  0, (PETSC\_type)(-\/2.0 / delta2));}
\DoxyCodeLine{55     Utils\_Fill::fill\_band(a, 1, (PETSC\_type)(1.0 / delta2));}
\DoxyCodeLine{56     \textcolor{comment}{// overwrite with boundary conditions at f(0) = f(1) = 0}}
\DoxyCodeLine{57     a( 0, 0 ) = 1.0;}
\DoxyCodeLine{58     a( 0, 1 ) = 0.0;}
\DoxyCodeLine{59     a( N -\/ 1, N -\/ 1 ) = 1.0;}
\DoxyCodeLine{60     a( N -\/ 1, N -\/ 2 ) = 0.0;}
\DoxyCodeLine{61     \textcolor{comment}{// not a generalised problem -\/ but we'll apply that routine anyway}}
\DoxyCodeLine{62     \textcolor{comment}{// b is the RHS matrix, so it's -\/I}}
\DoxyCodeLine{63     SparseMatrix<PETSC\_type> b( N, N );}
\DoxyCodeLine{64     Utils\_Fill::fill\_identity( b );}
\DoxyCodeLine{65     b.scale( -\/1.0 );}
\DoxyCodeLine{66     b( 0, 0 ) = 0.0;}
\DoxyCodeLine{67     b( N -\/ 1, N -\/ 1 ) = 0.0;}
\DoxyCodeLine{68     \textcolor{comment}{// a vector for the eigenvectors -\/ although we won't use them}}
\DoxyCodeLine{69     DenseMatrix<D\_complex> eigenvectors;}
\DoxyCodeLine{70 }
\DoxyCodeLine{71     SparseLinearEigenSystem<PETSC\_type> system( \&a, \&b );}
\DoxyCodeLine{72     system.set\_calc\_eigenvectors( \textcolor{keyword}{true} );}
\DoxyCodeLine{73     system.set\_nev(4);}
\DoxyCodeLine{74     system.set\_order( \textcolor{stringliteral}{"EPS\_TARGET\_MAGNITUDE"} ); \textcolor{comment}{//default}}
\DoxyCodeLine{75 }
\DoxyCodeLine{76     timer.start();}
\DoxyCodeLine{77     \textcolor{keywordflow}{try}}
\DoxyCodeLine{78     \{}
\DoxyCodeLine{79       system.eigensolve();}
\DoxyCodeLine{80     \}}
\DoxyCodeLine{81     \textcolor{keywordflow}{catch} (\textcolor{keyword}{const} std::runtime\_error \&error )}
\DoxyCodeLine{82     \{}
\DoxyCodeLine{83       cout << \textcolor{stringliteral}{" \(\backslash\)033[1;31;48m  * FAILED THROUGH EXCEPTION BEING RAISED \(\backslash\)033[0m\(\backslash\)n"};}
\DoxyCodeLine{84       \textcolor{keywordflow}{return} 1;}
\DoxyCodeLine{85     \}}
\DoxyCodeLine{86     system.tag\_eigenvalues\_disc( + 1, 10. );}
\DoxyCodeLine{87     lambdas = system.get\_tagged\_eigenvalues();}
\DoxyCodeLine{88     eigenvectors = system.get\_tagged\_eigenvectors();}
\DoxyCodeLine{89     cout << \textcolor{stringliteral}{"    "} << N << \textcolor{stringliteral}{" : "} << lambdas[ 0 ].real() -\/ M\_PI * M\_PI}
\DoxyCodeLine{90          << \textcolor{stringliteral}{" : "} << timer.get\_time() << \textcolor{stringliteral}{"\(\backslash\)n"};}
\DoxyCodeLine{91     timer.stop();}
\DoxyCodeLine{92   \}}
\DoxyCodeLine{93 }
\DoxyCodeLine{94 }
\DoxyCodeLine{95   \textcolor{keyword}{const} \textcolor{keywordtype}{double} tol = 1.e-\/4;}
\DoxyCodeLine{96   \textcolor{keywordflow}{if} ( abs( lambdas[ 0 ].real() -\/ M\_PI * M\_PI ) > tol )}
\DoxyCodeLine{97     failed = \textcolor{keyword}{true};}
\DoxyCodeLine{98 }
\DoxyCodeLine{99   \textcolor{keywordflow}{if} ( failed )}
\DoxyCodeLine{100   \{}
\DoxyCodeLine{101     cout << \textcolor{stringliteral}{"\(\backslash\)033[1;31;48m  * FAILED \(\backslash\)033[0m\(\backslash\)n"};}
\DoxyCodeLine{102     cout << \textcolor{stringliteral}{"    Final error = "} << abs( lambdas[ 0 ].real() -\/ M\_PI * M\_PI ) << \textcolor{stringliteral}{"\(\backslash\)n"};}
\DoxyCodeLine{103     \textcolor{keywordflow}{return} 1;}
\DoxyCodeLine{104   \}}
\DoxyCodeLine{105 }
\DoxyCodeLine{106   cout << \textcolor{stringliteral}{"\(\backslash\)033[1;32;48m  * PASSED \(\backslash\)033[0m\(\backslash\)n"};}
\DoxyCodeLine{107   \textcolor{keywordflow}{return} 0;}
\DoxyCodeLine{108 \}}

\end{DoxyCode}


References Cpp\+Noddy\+::\+Example\+::failed, Utils\+\_\+\+Fill\+::fill\+\_\+band(), Utils\+\_\+\+Fill\+::fill\+\_\+identity(), Cpp\+Noddy\+::\+Timer\+::get\+\_\+time(), Cpp\+Noddy\+::\+Utility\+::real(), Cpp\+Noddy\+::\+Sparse\+Matrix$<$ \+\_\+\+Type $>$\+::scale(), Cpp\+Noddy\+::\+Timer\+::start(), and Cpp\+Noddy\+::\+Timer\+::stop().

